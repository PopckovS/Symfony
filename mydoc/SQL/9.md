## SQL Урок 9 

Существуют 3 вида обьеденений:

1) Самообьеденение

Используется когда необходимо связывать данные из таблицы с этойже
таблицей, предположим что нам требуется выбрать всех пользователей 
по работников некотрой компании к которой принадлежит человек по 
имени 'Jim Jones'

Пример решения подзапросом:

1. Для выполнения этой инструкции, нам требуется с начала выяснить значение 
поля cust_contract для человека с именем 'Jim Jones'.
   

    SELECT company_name 
    FROM Customers 
    WHERE customers_name = 'Jim Jones';
        
Так мы находим нужное значение при помощи подзапроса.
    
2. Теперь получив название нужной компании мы делаем запрос на получение 
всех записей у которых есть именно эта компания.
   
    
    SELECT company_name, customers_name 
    FROM Customers
    WHERE company_name = ЗНАЧЕНИЕ ИЗВЛЕЧЕННОЕ НА ПРЕВЕДУЩЕМ ЭТАПЕ

Обьеденяем их вместе


    SELECT company_name, customers_name 
    FROM Customers
    WHERE company_name = (SELECT company_name 
                          FROM Customers 
                          WHERE customers_name = 'Jim Jones');
        
Решение при помощи самообьеденения таблицы с самой сабой:

    
    SELECT c1.company_name, c1.customers_name
    FROM Customers AS c1, Customers AS c2
    WHERE c1.company_name = c2.company_name
    AND c2.customers_name = 'Jim Jones';

Таблица Customers появляется в запросе FROM дважды, это требуется для
того чтобы работать с одной и тойже таблицей но через 2 разных алиаса.

Это предложение `WHERE c1.company_name = c2.company_name` указывает
как связать 2 таблицы между собой, а затем фильтруем данные второй
таблицы, при помощи этого `AND c2.customers_name = 'Jim Jones';`

Подзапросы работают медленнее чем самообьеденение.

2) Естественные обьеденения

Когда обьеденяется несколько таблиц, покрайней мере один столбец 
будет фигурировать во всех таблицах, по нему и будет происходить 
обьеденение.

Естественным называют обьеденения при котором извлекаются только
не повторяющиеся столбцы, обычно это делается при помощи `SELECT *`
для одной таблицы и указания явных полей других столбцов всех остальных 
таблиц.

    SELECT C.*, 
           O.order_num, O.order_date,
           OI.prod_id, OI.quantity, OI.item_price
    FROM Customers AS C, Order AS O, OrderItem AS OI
    WHERE C.cust_id = O.cust_id
    AND OI.order_num = O.order_num
    AND prod_id = 'RGAN01';

3) Внешнее обьеденение

Большинство обьеденений связывают таблицы по некотрому полю что их 
и обьеденяет, но может потребоваться включать в результат строки
не имеющие пар. Например для решения следующих задачь:

1. Подсчет колич заказов каждого клиента включая тех кто еще 
не сделал заказа.

2. Составления перечня товаров с указанием колич заказов на них,
включая товары,оторые никем не были заказаны.

3. Вычисление средних обьемов продаж с учетом клиентов, которые 
еще не сделали заказ. 

В каждом из примеров требуется выбрать строки не имеющих 
ассоциированных с ними строк из другой таблицы.

Это пример обьеденения 2 таблиц по полю `cust_id` что етсь в обьих 
таблицах,ли проще говоря обычный `INNER JOIN`. Тоесть извлекаются 
данные из обоих таблич то связаны между собой, и каждая извлеченная
запись имеет данные из обоих таблиц.

    SELECT Customers.cust_id, Orders.order_num
    FROM Customers 
    INNER JOIN Orders
    ON Customers.cust_id = Orders.cust_id;

Пример внешнего обьеденения.

    SELECT Customers.cust_id, Orders.order_num
    FROM Customers LEFT OUTER JOIN Orders
    ON Customers.cust_id = Orders.cust_id;









