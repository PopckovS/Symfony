##Фреймворк Django

### Введение, становка Вирт среды
На момент 2020 актуальной версией является Django 3.0 Как мы помним Python 
можно делать виртуальное окружение virtualenv. Тоесть мы можем установить
Django к локально в вирт.окружение так и глобально, но при установке 
глобально, может возникнуть конфлик версий, если глобально установить
несколько версий они могут конфликт др с др, если зависят от рвзных версий 
одного и того же пакета.

    // Глобальная установка библиотеки для создания вирт сред
    pip3 install virtualenv

    // Может возникнуть ошибка
    // The virtual environment was not created successfully 
    // because ensurepip is not available
    // для ее исправления используем
    sudo apt-get install python3-venv

    // Создание вир среды в конкретном каталоге для версии Python более 3
    python3 -m venv env

Создан каталог `env` в который будет уст-ть лок библиотеки.

    // Чтобы перевести терминал в раежим работы с вирт средой 
    // конкретно этого проекта, используем 
    source env/bin/activate

Видим что в терминале появляется префикс `env` что указывает что мы работаем
с этой вирт средой. Чтобы деактивировать работу с этой вирт средой запустим:

    (env) $ deactivate

### Шаг 1 Создание проекта
Устанавливаем Django локально:

    pip3 install django

Проверка что Django установлен:

    python3 -m django --version
    
    3.1.15

После того как Django установлен локально, создаем проект при помощи команды:

    django-admin startproject mysite

django-admin - Утилита для работы с Django, startproject - создать проект,
mysite - название проекта.

После создания,олучим следуюшую структуру приложения:

    mysite/
        manage.py
        mysite/
            __init__.py
            settings.py
            urls.py
            asgi.py
            wsgi.py

Разерем проект по файлам:

1.mysite/ - Внешний контейнер, его бназвание значение не имеет.

2.manage.py - утилита,ля работы с проектом на Django. По сути это просто 
эквивалент `bin/console` из фреймворкка Symfony.

3.mysite/ внутренний каталог, из него будем импортировать нужные модули.

4.`__init__.py` Пустой файл что указывает что даанная директория, должна 
расматриваться как пакет питона.

5.settings.py файл конфигов, является ангалогом файла .env из Symfony.

6.urls.py тут собраны URL сайта

7.asgi.py - ASGI запуск собственного сервера для проекта.

8.wsgi.py - WSGI точка входа для совместных веб серверов.

### Шаг 2 Запуск проекта
Переходим в директорию проекта, и запускаем сервер проекта, по умолчанию 
сервер зарпускается на 8000 порту,  это можно изменить указав нужный
порт, при запуске сервера.

    // Запуск на 8000 порту
    python manage.py runserver

    // Запуск на 2323 порту
    python manage.py runserver 2323

Эта команда запустит сервер на порту  `http://127.0.0.1:8000/` также в корне 
проекта будет создан `db.sqlite3` по дефолту проект работает с БД SQL Lite.
также если в настойках не указана другая Бд с которой мы будем работать, то 
файл `db.sqlite3` будет сгенерирован в корне сайта автоматически.

Также при запуске получим предепредждение о том что миграции не применены,
тоетсь невыполнены миграции для создания основных записей в Бд для работы
приложения, и предложение выполнить эти миграции для работы приложения.

    You have 18 unapplied migration(s). 
    Your project may not work properly until you apply the migrations
    for app(s): admin, auth, contenttypes, sessions.

    Run 'python manage.py migrate' to apply them.

### Шаг 3 Создание приложения

Проект - сам сайт со множеством приложений и БД.

Приложение - отдельный модуль который имеет свою внутренюю сеть URL адресов,
свои модели, миграции, виды, тесты и контроллеры. Каждое приложение в проекте
Django должно следовать определенному соглашению.

Создадим первое приложение при помои утилиты, которая самостоятельно сгенерирует
необходимый каталог директорий и оформит его в модуль питона с файлом `__init__.py`

    python3 manage.py startapp polls

Это создаст в корне проекта на одном уровне с ядром `mysite` приложение `polls`.
приложение polls имеет солед структуру:

    polls/
        __init__.py
        admin.py
        apps.py
        migrations/
            __init__.py
        models.py
        tests.py
        views.py

Сущьность работы с приложениями в Django заключается в их модульности, каждое 
из приложений можно разрабатывать отдельно, и подключать в любой проект,
у каждого приложения имеется свои внутреннии URL адреса, торые определяются
в нутри каждого приложения отдельно, а при подключении приложения в проект, 
всем внутренним URL адресам приложения дается один корневой внешний URL который
определяется в ядре проекта, таким образом мы можем иметь древовидную структуру
проекта, где каждому приложения соответствует его ветка URL адресов, и можно 
одной записью в главном конфиге URL адресов менять весь корень пути приложения.

После создания приложения:
#### Создаем представление и внутреннего URL
В созданном приложении будет автоматически сгенерированное представление
`polls/views.py` запишем в этом представление след код:

    from django.http import HttpResponse

    def index(request):
        return HttpResponse("Hello, world. You're at the polls index.")

Из модуля djsngo.http мы импортируем HttpResponse для раоты с запросами,
и определяем функцию index() с аргументом в виде пришедшего запроса, и 
возвращаем из функции обьект HttpResponse.

Так мы создали представление, теперь для того чтобы оно работало мы должны
сопоставить его с URL, для этого создадим в приложении требуется создать
файл `urls.py` который будет определять в себе, внетрении URL с путями для
этого приложения.

Файл `urls.py` автоматически не генерируется.

Теперь в файле `polls/urls.py` запишем следующее:

    // Импорт функции для генерации URL путей
    from django.urls import path
    // Импорт представления из этого приложения
    from . import views
    
    // Определяем список с внутренними путями URL
    urlpatterns = [
        path('', views.index, name='index'),
    ]

Функция `path()` принимает 4 аргумента для генерации URL путей:

1. route (Обезательный) - строка с URL который будет сопоставлен URL
из строки браузера. Тут не имеет значения какой GET параметр передан 
вместе с URL, с точки зрения приложения эти 2 URL будут одинаковые:
   

    https://www.example.com/myapp/
    https://www.example.com/myapp/?Page=3

2. view (Обезательный) - Второй параметр `views.index` он указывает на 
   функцию представления,  с аргументом в виде запросав котором будет 
   содержаться GET параметры.

3. kwargs - произвольные аргументы.

4. name - Специальное название алиас для конкретно этого представления, 
чтобы ссылаться на него из других шаблонов.
   
#### Интеграция приложения в проект, и присвоение ему внешнего корневого URL
Следующий шаг это присвоить корневой URL как родителя для всех 
внутренних URL приложения.

В `mysite/urls.py` в котором указаны пути для корня приложения, доюавляем
    
    from django.urls import include, path

Функция path() уже знакома, она генерирует пути. Фугкция include() позволяет
нерировать корневой путь для всех внутренних путей приложения, добавим
в этот файл следующее:

    urlpatterns = [
        path('polls/', include('polls.urls')),
        path('admin/', admin.site.urls),
    ]

`path('polls/', include('polls.urls'))` Здесь первый параметр становится
корневым URL приложения, а при помощи функции `include('polls.urls')` 
мы подключаем пути приложения, указывая модулб и файл с путями.

Мы всегда должны использовать include для подключения приложения, где
admin.site.urls является единстенным исключением, он дефолтно указывет
на админку.



